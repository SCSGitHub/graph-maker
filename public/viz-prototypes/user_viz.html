<!DOCTYPE html>
<meta charset="utf-8">
<head><link href="nouislider/nouislider.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!-- <link rel="stylesheet" href="/resources/demos/style.css"> -->
    <link rel="stylesheet" href="css/user_viz.css">
    <link href="jquery-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
</head>

<body>

    <script src="data/papers.js"></script>
    <script src="data/edges.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
   <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script src="nouislider/nouislider.min.js"></script>
<div class="totalContainer">
<div class="mainContainer">

    <div class="container1" id="tabs">
        <ul>
            <li><a id="tab-title-authors" href="#tabs-1">Authors <span id="tab-authors-badge" class="badge">0</span></a></li>
            <li><a id="tab-title-papers" href="#tabs-2">Papers <span id="tab-papers-badge" class="badge">0</span></a></li>
        </ul>

        <div id="tabs-1">
            Select a node to explore authors in the 'conceptual neighborhood' of the node
        </div>
        <div id="tabs-2">
            Select a node to explore papers in the 'conceptual neighborhood' of the node
        </div>
    </div>
     <label class="yearFilter">Filter by year</label>
    <div class="yearRange" id="slider">

    </div>

    <div class="ui-widget">
        <div class="labelAuthors">
            <label class ="labelClass" for="tags">Filter by author </label>
            </div>
            <input  id="tags">
    </div>

 <div>
     <select id="drop">
        <option value="1">Level 1</option>
        <option value="2">Level 2</option>
        <option value="3">Level 3</option>
     </select>
</div>

<div>
    <button class="filterButton" id="clearfilter" type="button" onclick="clearFilter()">Clear Filters</button>
</div>
</div>

<div class="graphContainer">
<svg class="graph" width="1200" height="1000"></svg>
</div>
</div>
<script>

var windowHeight = $(window).height();
var windowWidth = $(window).width();
console.log("window viewport height = " + windowHeight.toString());
console.log("window viewport width = " + windowWidth.toString());
$('.graphContainer').height(windowHeight-20);
$('.graphContainer').css("max-height", windowHeight-20);
$('.graphContainer').width(windowWidth-20);
$('.graphContainer').css("max-width", windowWidth-20);

$('.graph').height(windowHeight-20);
$('.graph').css("max-height", windowHeight-20);
$('.graph').width(windowWidth-20);
$('.graph').css("max-width", windowWidth-20);

$('#tabs-1').css("max-height", windowHeight/3);
$('#tabs-2').css("max-height", windowHeight/3)

var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);


  var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height")


  svg.append("rect")
    .attr("width", width)
    .attr("height", height)
    .style("fill", "none")
    .style("pointer-events", "all")
    .call(d3.zoom()
        .scaleExtent([1 / 2, 4])
        .on("zoom", zoomed));

  var zoom = d3.zoom()
    .scaleExtent([1 / 2, 4])
    .on("zoom", zoomed);

    /***
    Apply zoom to the graph
    ***/
  function zoomed() {
        g.attr("transform", d3.event.transform);
  }

  var g = svg.append("g");

  // control the force-directed layout properties
  simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) {
      return d.id;
    }))
    .force("charge", d3.forceManyBody().strength(function(d) {
      // return -20;
      return -19-d.paperID.length*20; // give greater repulsion for larger nodes
    }))
    // .force("collision", d3.forceCollide().strength(function(d) {
    //   // -20
    //   return 0.2;
    // }))
    .force("center", d3.forceCenter(width / 2, height / 2));

//    .force('link', d3.forceLink(heart.links).distance(0).strength(0.1))

    // define the graph
    /// TODO: read in from separate json/js file

  var scaleFactor=6;

  var defaultRadius=3;

  var topicRadius = 15;


d3.json("data/graph.json", function(error, graph){
    if (error) throw error;

  // define visual properties of edges
  var link = g.append("g")
    .attr("class", "links")
    //.selectAll("link")
    .data(graph.nodes)

    //.attr("class", "dataLinks")
    .selectAll("line")
    .data(graph.links)
    .enter().append("line")
    .classed("dataLinks", true)
    // .style("stroke", function(d){
    //     if(d.valence=="positive"){
    //         return "green";
    //     }
    //
    //     else if(d.valence=="negative"){
    //         return "red";
    //     }
    // })
        .attr("id", function(d){
          return 'link' + d.id;
          })
    .attr("stroke-dasharray", function(d) {
          if (d.type=="analogy") {
              return "5,5";
          }
      })
    .attr("marker-end", "url(#arrow)")
    .attr("opacity", 0.5);


  // define properties of nodes
  var node = g.append("g")
    .attr("class", "nodes")
    .selectAll("circle")
    .data(graph.nodes)
    .enter().append("circle")
    .attr("r", function(d){
        if(d.type=='action' || d.type=='why-hard')
        // return defaultRadius;
        return defaultRadius+Math.log(d.paperID.length)*10;

        if(d.type=='topic')
            return topicRadius;})
   .attr("class", "dataNodes")
   .attr('id', function(d){ return 'id' + d.id; })
   .attr('opacity', function(d) {
     if (d.paperID.length < 2) {
       return 0.25;
     } else {
       return 0.5+d.paperID.length/10;
     }
   })
    //.style("stroke", "black")
    //.style("stroke-width", ".5px")
    .style("fill", function(d){
        // if(d.paperID.length < 2)
            // return '#dcdcdc';
        // else if(d.type=='action')
        if(d.type=='action')
            return '#247';

        else if(d.type=='why-hard')
            return 'red';

        else if(d.type=='topic')
            return '#00BFFF';
    })
    .attr('cy', function(d) { return d.distance_from_root; })
    .on("mouseover", function(d) {
       div.transition()
         .duration(200)
         .style("opacity", .9);
       div.html(d.name)
         .style("left", (d3.event.pageX) + "px")
         .style("top", (d3.event.pageY - 28) + "px");
       })
     .on("mouseout", function(d) {
       div.transition()
         .duration(500)
         .style("opacity", 0);
       })
    .on("click", neighboring)
    //.on("click", fade(.1))
    .on('dblclick', clicked); // set event handler for click event


    svg.append("defs").append("marker")
    .attr("id", "arrow")
    .attr("viewBox", "0 -5 10 10")
    .attr("refX", 20)
    .attr("refY", 0)
    .attr("markerWidth", 4)
    .attr("markerHeight", 4)
    .attr("orient", "auto")
    .append("svg:path")
    .attr("d", "M0,-5L10,0L0,5");



  // define visual properties of node labels

 var text = g.append("g")
    .attr("class", "labels")
    .selectAll("text")
    .data(graph.nodes)
    .enter().append("text")
    .attr("class", "dataLabels")
    // .attr("font-size","6px")
    .attr("font-size", function(d) {
      return parseInt(6+Math.log(d.paperID.length)*10).toString() + 'px';
    })
    .attr("dx", 6)
    .attr('id', function(d){ return 'label' + d.id; })
    .attr("dy", ".15em")
    .text(function(d) {
        var string = d.name

        if (d.paperID.length < 2) {
            return "";
        } else if (string.length > 15) {
          return string.substring(0,17)+'...';
        } else {
          return string;
        }
       });

  // apply force-directed layout
  simulation
    .nodes(graph.nodes)
    .on("tick", ticked); //

  simulation.force("link")
    .links(graph.links);

    /***
    Recompute force-directed layout after user interaction with nodes
    ***/
  function ticked() {
    link
      .attr("x1", function(d) {
        return d.source.x;
      })
      .attr("y1", function(d) {
        return d.source.y;
      })
      .attr("x2", function(d) {
        return d.target.x;
      })
      .attr("y2", function(d) {
        return d.target.y;
      });

    node
      .attr("cx", function(d) {
        return d.x;
      })
      .attr("cy", function(d) {
        return d.y;
      });

    text.attr("x", function(d) { return d.x; })
        .attr("y", function(d) { return d.y; });
  }

 });


  // unselect all nodes
  var active = d3.select(null);

  /***
  Control interactions with nodes
  ***/
  function clicked(d) {


    // do nothing if it's the one we already selected
    if (active.node() === this){
      active.classed("active", false);
      return reset();
    }

    // grab the active node(s)
    active = d3.select(this).classed("active", true);


    if(d.type=='action' || d.type=='why-hard')  {
     //focus around the spot of the selected node(s)
    svg.transition()
      .duration(750)
      .call(zoom.transform,
        d3.zoomIdentity
        .translate(width / 2, height / 2)
        .scale(scaleFactor)
        .translate(-(+active.attr('cx')), -(+active.attr('cy')))

      );
       console.log(active);
  }

      d3.select("#tabs-1").text(d.authors);
      d3.select("#tabs-2").text(d.id);



  }


  /***
  Reset to master view
  ***/
  function reset() {
    svg.transition()
      .duration(750)
      .call(zoom.transform,
        d3.zoomIdentity
        .translate(0, 0)
        .scale(1)
      );
  }


var nodesByYearFilter=[];
var nodesByAuthorFilter=[];

//var allNodesInGraph=[];
returnAllNodes();



function returnAllNodes(){

d3.json("data/nodes.json", function(d){

for (var i=0; i<d.length; i++){
    nodesByYearFilter[i]="#id"+(d[i].id);
}
//    console.log(nodesByYearFilter);

for (var i=0; i<d.length; i++){
    nodesByAuthorFilter[i]="#id"+(d[i].id);
}
//    console.log(nodesByAuthorFilter);


});

}



//console.log(testNodes);



var toggleTime=500;  //set toggle time for transition (in milliseconds)

function FilterByAuthor(){

d3.json("data/author_connections.json", function(d) {

var listOfNodes=(d[document.getElementById("tags").value]);

    for(i=0; i< listOfNodes.length; i++){
    listOfNodes[i]= '#id' + listOfNodes[i];
    }

    nodesByAuthorFilter=listOfNodes;


    finalFilter();
});
}




function clearFilter(){
     d3.selectAll(".dataNodes")
     .transition()
     .duration(toggleTime)
     .style("opacity", 1)
     .attr("r", function(d){
         if(d.type=='action' || d.type=='why-hard')
         // return defaultRadius;
         return defaultRadius+Math.log(d.paperID.length)*10;

         if(d.type=='topic')
             return topicRadius;
           })
      .attr("stroke", "black")
       .style("stroke-width", ".5px")
       .attr('opacity', function(d) {
         if (d.paperID.length < 2) {
           return 0.25;
         } else {
           return 0.5+d.paperID.length/10;
         }
       });

     d3.selectAll(".dataLabels")
     .transition()
     .duration(toggleTime)
     .style("opacity", 1)
     .attr("font-size", function(d) {
       return parseInt(6+Math.log(d.paperID.length)*10).toString() + 'px';
     })
     .text(function(d) {
         var string = d.name

         if (string.length > 15)
             return string.substring(0,17)+'...';
         else
             return string;
        });

     d3.selectAll(".dataLinks")
     .transition()
     .style("opacity", 0.5);

     document.getElementById("tabs-1").innerHTML = "Select a node to explore authors in the 'conceptual neighborhood' of the node";
     document.getElementById("tabs-2").innerHTML = "Select a node to explore papers in the 'conceptual neighborhood' of the node";

     document.getElementById("tab-authors-badge").innerText = 0;
     document.getElementById("tab-papers-badge").innerText = 0;

}

var slider = document.getElementById('slider');


noUiSlider.create(slider, {
	start: [2012, 2017],
    tooltips: true,
	connect: true,
    step: 1,
	range: {
		'min': 2012,
		'max': 2017
	}
});

slider.noUiSlider.on('change', function(){
	var rangeValues=slider.noUiSlider.get();
    var min=rangeValues[0];
    var max=rangeValues[1];

   filterByYear(min,max);

});

function filterByYear(min,max){

    d3.json("data/graph.json", function(d) {

        var listOfFilteredNodeIDs=[];
        var listOfNodes = d.nodes;


        for(i=0; i< listOfNodes.length; i++){

            for(j=0; j<(listOfNodes[i].years).length; j++){
                if(listOfNodes[i].years[j]<=max && listOfNodes[i].years[j]>=min){
                    listOfFilteredNodeIDs.push(listOfNodes[i].id);

                }
            }

         }

         for(i=0; i< listOfFilteredNodeIDs.length; i++){
            listOfFilteredNodeIDs[i]= '#id' + listOfFilteredNodeIDs[i];
         }

         var stringOfNodes= listOfFilteredNodeIDs.toString();

         nodesByYearFilter=listOfFilteredNodeIDs;

         finalFilter();
    });

}

$( function() {
    $( "#tabs" ).tabs();
});


$(function() {
    var availableTags = [
    "Jodi L. Forlizzi",
    "Walter Lasecki",
    "Aniket Kittur",
    "Alessandro Acquisti",
    "Lorrie Faith Cranor",
    "Kurt Luther",
    "Sophie Vennix",
    "Robert E. Kraut",
    "Sara Kiesler",
    "Laura Dabbish",
    "Gabriela Marcu",
    "Scott Hudson",
    "Nathaniel Fruchter",
    "Felicia Y Ng",
    "W. Ben Towne",
    "Jeffrey M. Rzeszotarski",
    "Anita Williams Woolley",
    "Steven Dang",
    "Manya Sleeper",
    "Jeffrey Bigham",
    "Anind Dey",
    "Winnie Leung",
    "Laura A. Dabbish",
    "Thomas Garncarz",
    "Lixiu Yu",
    "Min Kyung Lee",
    "Yi-Chia Wang",
    "Mark E Whiting",
    "Joel Chan",
    "Steven P. Dow",
    "Anind K. Dey",
    "Haiyi Zhu",
    "Jeffrey P. Bigham"
  ];
    $( "#tags" ).autocomplete({
      source: availableTags
    });
  } );


$( "#tags" ).on( "autocompleteselect", function( event, ui ) {
    FilterByAuthor();
} );

    function neighboring(d){
        d3.selectAll(".dataNodes").style("stroke", "black")
         .style("stroke-width", ".5px");

        d3.select(this).style("stroke", "orange")
         .style("stroke-width", "5px");

        var nodeID=d.id;

        var listOfNodes;
         d3.json("data/node_neighborhoods.json", function(d) {


             if(document.getElementById("drop").value=='1'){
                  listOfNodes=d[nodeID][1];
             }

              if(document.getElementById("drop").value=='2'){
                  listOfNodes=d[nodeID][1];
                  listOfNodes=listOfNodes.concat(d[nodeID][2]);
             }

             if(document.getElementById("drop").value=='3'){
                  listOfNodes=d[nodeID][1];
                  listOfNodes=listOfNodes.concat(d[nodeID][2]);
                  listOfNodes=listOfNodes.concat(d[nodeID][3]);
             }


             listOfNodes=listOfNodes.concat(nodeID);

             listOfNodeIds = [];
             for(var i=0; i<listOfNodes.length; i++){
                //  listOfNodes[i]= '#id' + listOfNodes[i];
                 listOfNodeIds.push('#id' + listOfNodes[i]);
             }

             var stringOfNodes= listOfNodeIds.toString();

             var listOfLabels=listOfNodeIds;

             listOfLabels=listOfLabels.concat('#id'+ nodeID);

             for(i=0; i< listOfLabels.length; i++){
                    listOfLabels[i]= listOfLabels[i].replace('#id', '#label');
             }

             var stringOfLabels= listOfLabels.toString();

             var listOfLinks=filterLinks(listOfNodes);

            //  listOfLinks=listOfLinks.concat('#id'+ nodeID);

             for(i=0; i< listOfLinks.length; i++){
                    // listOfLinks[i]= listOfLinks[i].replace('#id', '#link');
                    listOfLinks[i]= '#link' + listOfLinks[i];
             }

             var stringOfLinks= listOfLinks.toString();
             console.log(stringOfLinks);



             filterByNeighbors(stringOfNodes, stringOfLabels, stringOfLinks);

            //  document.getElementById("tabs-2").innerHTML = "";
            //  console.log(listOfNodes);
             var listOfAuthors = paperDetails(listOfNodes);
             authorDetails(listOfAuthors);

         });

          //  d3.select("#tabs-1").text(d.authors);



   }

    function paperDetails(nodes){
      // console.log("calling paperDetails")
      // console.log(papers);
        var numPapers = 0;
        var authors=[];
        var authorNames = [];
        var p = document.getElementById("tabs-2");
        p.innerHTML = "";
        // d3.json("data/papers.json", function(data) {
            // console.log(data);
            for(i=0; i<papers.length; i++){
                if (findOne(papers[i].nodeIDs, nodes)) {
                // }
                // if(d.paperID.indexOf(papers[i].paperID)!=-1) {
                    // papers.push(data[i].title);
                    // console.log(papers[i])
                    numPapers += 1;
                    p.appendChild(newPaper(papers[i]));
                    var paperAuthors = papers[i].author_arr
                    // console.log(paperAuthors);
                    for (j=0; j<paperAuthors.length; j++) {
                      if (authorNames.indexOf(paperAuthors[j]) < 0) {
                        authors.push(
                          {
                            'name': paperAuthors[j],
                            'title': "CMU HCII Faculty",
                            'url': ""
                          }
                        );
                        authorNames.push(paperAuthors[j]);
                      }
                    };
                }
            }
            tabBadge = document.getElementById("tab-papers-badge");
            tabBadge.innerText = numPapers;
            // tabTitle.appendChild(badge);
              //  d3.select("#tabs-2").text(papers);
        // });
        return authors;
    }

    function authorDetails(authors) {
      var p = document.getElementById("tabs-1");
      p.innerHTML = "";
      authors.forEach(function(author) {
        p.appendChild(newAuthor(author));
      });
      var tabBadge = document.getElementById("tab-authors-badge");
      tabBadge.innerText = authors.length;
    };

    function findOne(haystack, arr) {
      return arr.some(function (v) {
          return haystack.indexOf(v) >= 0;
      });
    };

    function filterLinks(nodes) {
      var edgeIDs = [];
      edges.forEach(function(edge) {
        if (nodes.indexOf(edge.source) >= 0 && nodes.indexOf(edge.target) >= 0) {
          edgeIDs.push(edge.id);
        }
      });
      return edgeIDs;
    }

//    function filterByName(nodes, labels){
    function finalFilter(){

    //console.log(allNodesInGraph);
    console.log("Year="+nodesByYearFilter);
    console.log("Author"+nodesByAuthorFilter);


    var finalListOfLabels=[];
    // var finalListOfLinks=[];


    var finalListOfNodes=intersect(nodesByAuthorFilter, nodesByYearFilter);
    console.log("intersectionOfNodes"+finalListOfNodes);

    var finalStringOfNodes = finalListOfNodes.toString();


    for(i=0; i< finalListOfNodes.length; i++){
        finalListOfLabels[i]= finalListOfNodes[i].replace('#id', '#label');

     }

     var finalStringOfLabels=finalListOfLabels.toString();


     var nodeList = []
     finalListOfNodes.forEach(function(n) {
       nodeList.push(n.replace("#id",""));
     });
     var finalListOfLinks=filterLinks(nodeList);
     for(i=0; i< finalListOfLinks.length; i++){
              finalListOfLinks[i]= '#link' + finalListOfLinks[i];

     }

     var finalStringOfLinks=finalListOfLinks.toString();


        d3.selectAll(".dataNodes").transition().duration(toggleTime).style("opacity", 0.1);
        d3.selectAll(".dataLabels").transition().duration(toggleTime)
          .style("opacity", 0.2)
          .text(function(d) {
              var string = d.name

              if (string.length > 15)
                  return string.substring(0,17)+'...';
              else
                  return string;
             });
        d3.selectAll(".dataLinks").transition().duration(toggleTime).style("opacity", 0.1);


        d3.selectAll(finalStringOfNodes).transition().duration(toggleTime).style("opacity", 1);
        d3.selectAll(finalStringOfLabels).transition().duration(toggleTime)
          .style("opacity", 1)
          .text(function(d) {
              var string = d.name

              if (string.length > 40)
                  return string.substring(0,42)+'...';
              else
                  return string;
             });;
        d3.selectAll(finalStringOfLinks).transition().duration(toggleTime).style("opacity", 0.5);


}




function intersect(a, b) {
    var t;
    if (b.length > a.length) t = b, b = a, a = t; // indexOf to loop over shorter
    return a.filter(function (e) {
        if (b.indexOf(e) !== -1) return true;
    });
}

//console.log(labelsByYearFilter);

function filterByNeighbors(nodes, labels, links){

        d3.selectAll(".dataNodes")
        .transition()
        .duration(toggleTime)
        .style("opacity", 0.1)
        .attr("r", function(d){
            if(d.type=='action' || d.type=='why-hard')
            // return defaultRadius;
            return defaultRadius+Math.log(d.paperID.length)*10;

            if(d.type=='topic')
                return topicRadius;})

        d3.selectAll(".dataLabels")
        .transition()
        .duration(toggleTime)
        .style("opacity", 0.1)
        // .attr("font-size","6px");
        .attr("font-size", function(d) {
          return parseInt(6+Math.log(d.paperID.length)*10).toString() + 'px';
        })
        .text(function(d) {
            var string = d.name

            if (string.length > 15)
                return string.substring(0,17)+'...';
            else
                return string;
           });

        d3.selectAll(".dataLinks")
        .transition()
        .duration(toggleTime)
        .style("opacity", 0.1)

        d3.selectAll(nodes)
        .transition()
        .duration(toggleTime)
        .style("opacity", 1)
        // .attr("r", defaultRadius+5);
        .attr("r", function(d){
            if(d.type=='action' || d.type=='why-hard')
            // return defaultRadius;
            return 2+defaultRadius+Math.log(d.paperID.length)*10;

            if(d.type=='topic')
                return topicRadius;})

        d3.selectAll(labels)
        .transition()
        .duration(toggleTime)
        .style("opacity", 1)
        // .attr("font-size","10px");
        .attr("font-size", function(d) {
          return parseInt(8+Math.log(d.paperID.length)*10).toString() + 'px';
        })
        .text(function(d) {
            var string = d.name

            if (string.length > 40)
                return string.substring(0,42)+'...';
            else
                return string;
           });

        // console.log(links);
        d3.selectAll(links)
        .transition()
        .duration(toggleTime)
        .style("opacity", 0.5)


        simulation.restart()
}

function newPaper(item) {
  var d = document.createElement("div");

  d.setAttribute("class", "node-metadata");
  d.setAttribute("id", "paper-" + item.paperID);
  var title = document.createElement("p");
  title.setAttribute("class", "title");
  // var colTitle = document.createElement("div");
  // colTitle.setAttribute("class", "col-xs-8 col-md-8 title");
  title.appendChild(document.createTextNode(item.title));
  d.appendChild(title);
  var meta = document.createElement("p");
  meta.setAttribute("class", "meta");
  meta.appendChild(document.createTextNode("CSCW " + item.year + " | "));
  // outer.appendChild(colYear);
  // var colLink = document.createElement("div");
  // colLink.setAttribute("class", "col-xs-2 col-md-2 link");
  var a = document.createElement("a");
  a.setAttribute("href", item.url);
  a.setAttribute("target", "_blank");
  a.appendChild(document.createTextNode("more info"));
  // var span = document.createElement("span");
  // span.setAttribute("class", "glyphicon glyphicon-link")
  // a.appendChild(span);
  meta.appendChild(a);
  d.appendChild(meta);

  // d.appendChild(outer);

  return d;

}

function newAuthor(item) {
  var d = document.createElement("div");

  d.setAttribute("class", "node-metadata");
  d.setAttribute("id", "authorID");
  var title = document.createElement("p");
  title.setAttribute("class", "title");
  // var colTitle = document.createElement("div");
  // colTitle.setAttribute("class", "col-xs-8 col-md-8 title");
  title.appendChild(document.createTextNode(item.name));
  d.appendChild(title);
  var meta = document.createElement("p");
  meta.setAttribute("class", "meta");
  meta.appendChild(document.createTextNode(item.title + " | "));
  // outer.appendChild(colYear);
  // var colLink = document.createElement("div");
  // colLink.setAttribute("class", "col-xs-2 col-md-2 link");
  var a = document.createElement("a");
  a.setAttribute("href", item.url);
  a.setAttribute("target", "_blank");
  a.appendChild(document.createTextNode("more info"));
  // var span = document.createElement("span");
  // span.setAttribute("class", "glyphicon glyphicon-link")
  // a.appendChild(span);
  meta.appendChild(a);
  d.appendChild(meta);

  return d;
}





</script>

</body>
